# AWS デプロイ向けテスト項目

## 1. APIテスト

### 1.1 ヘルスチェック

| # | 種別 | テスト内容 | メソッド / パス | 期待結果 |
|---|------|-----------|----------------|----------|
| 1 | 正常 | ヘルスチェック応答 | `GET /api/health` | 200, `{"status":"ok"}` |
| 2 | 正常 | ルート応答 | `GET /` | 200, メッセージ返却 |

---

### 1.2 参加者フロー (Events)

#### イベント参加 (`POST /api/events/{event_id}/join`)

| # | 種別 | テスト内容 | 期待結果 |
|---|------|-----------|----------|
| 1 | 正常 | 正しい join_code で参加 | 200, session_id Cookie 発行, イベント情報返却 |
| 2 | 異常 | 誤った join_code | 403 Forbidden |
| 3 | 異常 | 存在しない event_id | 404 Not Found |
| 4 | 異常 | join_code 未指定（空文字） | 400 or 422 バリデーションエラー |
| 5 | 異常 | イベント状態が aborted | 適切なエラーメッセージ |

#### ユーザー登録 (`POST /api/events/{event_id}/users/register`)

| # | 種別 | テスト内容 | 期待結果 |
|---|------|-----------|----------|
| 1 | 正常 | display_name_base を指定して登録 | 200, 4桁サフィックス付き display_name 返却 |
| 2 | 異常 | session_id Cookie なし | 401 Unauthorized |
| 3 | 異常 | 無効な session_id | 401 Unauthorized |
| 4 | 異常 | イベント終了後に登録 | 409 quiz_finished |
| 5 | 異常 | display_name_base 未指定 | 400 or 422 バリデーションエラー |
| 6 | 異常 | 同一セッションで二重登録 | 409 or 適切なエラー |

#### ユーザー状態取得 (`GET /api/events/{event_id}/me/state`)

| # | 種別 | テスト内容 | 期待結果 |
|---|------|-----------|----------|
| 1 | 正常 | waiting 状態で取得 | 200, event.state="waiting", current_question=null |
| 2 | 正常 | running 状態 + 出題中に取得 | 200, 問題情報・選択肢・タイマー情報返却 |
| 3 | 正常 | 回答済みの状態で取得 | 200, my_answer に回答内容が含まれる |
| 4 | 正常 | reveal 後に取得 | 200, correct_choice_index が含まれる |
| 5 | 異常 | session_id Cookie なし | 401 Unauthorized |
| 6 | 異常 | 存在しない event_id | 404 Not Found |

#### 回答送信 (`POST /api/events/{event_id}/questions/{question_id}/answers`)

| # | 種別 | テスト内容 | 期待結果 |
|---|------|-----------|----------|
| 1 | 正常 | 制限時間内に正答を送信 | 200, result="accepted", is_correct=true |
| 2 | 正常 | 制限時間内に誤答を送信 | 200, result="accepted", is_correct=false |
| 3 | 異常 | 制限時間超過後に送信 | 200, result="rejected", reject_reason="deadline_passed" |
| 4 | 異常 | 同一問題に二重回答 | 409 Conflict |
| 5 | 異常 | 未登録ユーザーが回答 | 400 "not registered" |
| 6 | 異常 | アクティブでない question_id を指定 | 400 "question not active" |
| 7 | 異常 | session_id Cookie なし | 401 Unauthorized |
| 8 | 異常 | 存在しない question_id | 400 or 404 |
| 9 | 異常 | choice_index が範囲外（例: -1, 99） | 400 or 422 バリデーションエラー |

#### 結果取得 (`GET /api/events/{event_id}/results`)

| # | 種別 | テスト内容 | 期待結果 |
|---|------|-----------|----------|
| 1 | 正常 | 終了済みイベントのリーダーボード取得 | 200, rank 順にソートされた結果 |
| 2 | 正常 | 同点のユーザーがいる場合 | 回答時間で順位決定 |
| 3 | 異常 | 未終了イベントの結果取得 | 適切なエラー or 空の結果 |
| 4 | 異常 | 存在しない event_id | 404 Not Found |

#### CSV エクスポート (`GET /api/events/{event_id}/results/csv`)

| # | 種別 | テスト内容 | 期待結果 |
|---|------|-----------|----------|
| 1 | 正常 | CSV ダウンロード | 200, Content-Type=text/csv, BOM 付き UTF-8 |
| 2 | 正常 | CSV のカラム確認 | 順位,表示名,正解数,未回答数,正答率,回答時間合計(秒) |
| 3 | 異常 | 存在しない event_id | 404 Not Found |

#### 現在の問題取得 (`GET /api/events/{event_id}/questions/current`)

| # | 種別 | テスト内容 | 期待結果 |
|---|------|-----------|----------|
| 1 | 正常 | 出題中に取得 | 200, question 情報 + deadline 返却 |
| 2 | 正常 | 出題なし（waiting 状態） | 200, question=null |
| 3 | 異常 | 存在しない event_id | 404 Not Found |

#### ログアウト (`POST /api/events/{event_id}/logout`)

| # | 種別 | テスト内容 | 期待結果 |
|---|------|-----------|----------|
| 1 | 正常 | ログアウト成功 | 200, session_id Cookie 削除 |
| 2 | 異常 | session_id Cookie なし | 401 Unauthorized |

---

### 1.3 管理者フロー (Admin)

#### ログイン (`POST /api/admin/login`)

| # | 種別 | テスト内容 | 期待結果 |
|---|------|-----------|----------|
| 1 | 正常 | 正しいパスワードでログイン | 200, admin_session Cookie 発行 |
| 2 | 異常 | 誤ったパスワード | 401 Unauthorized |
| 3 | 異常 | パスワード未指定 | 400 or 422 |
| 4 | 異常 | 5回連続失敗後にログイン試行 | 429 Too Many Requests |
| 5 | 正常 | レート制限解除後（15分後）にログイン | 200 成功 |

#### セッション検証 (`GET /api/admin/verify`)

| # | 種別 | テスト内容 | 期待結果 |
|---|------|-----------|----------|
| 1 | 正常 | 有効な admin_session で検証 | 200, `{"status":"ok"}` |
| 2 | 異常 | Cookie なし | 401 Unauthorized |
| 3 | 異常 | 期限切れ Cookie（24時間超過） | 401 Unauthorized |
| 4 | 異常 | 改ざんされた Cookie 値 | 401 Unauthorized |

#### イベント作成 (`POST /api/admin/events`)

| # | 種別 | テスト内容 | 期待結果 |
|---|------|-----------|----------|
| 1 | 正常 | タイトル・問題IDリスト指定で作成 | 200, event_id・state="waiting" 返却 |
| 2 | 正常 | join_code 未指定（自動生成） | 200, join_code 自動付与 |
| 3 | 異常 | 管理者認証なし | 401 Unauthorized |
| 4 | 異常 | title 未指定 | 400 or 422 |
| 5 | 異常 | 存在しない question_id を含む | 400 or 404 |

#### 参加コード更新 (`PUT /api/admin/events/{event_id}/join-code`)

| # | 種別 | テスト内容 | 期待結果 |
|---|------|-----------|----------|
| 1 | 正常 | join_code を変更 | 200, 更新後の EventBrief |
| 2 | 異常 | 管理者認証なし | 401 |
| 3 | 異常 | 存在しない event_id | 404 |

#### イベント開始 (`POST /api/admin/events/{event_id}/start`)

| # | 種別 | テスト内容 | 期待結果 |
|---|------|-----------|----------|
| 1 | 正常 | waiting 状態から開始 | 200, state="running" |
| 2 | 異常 | 既に running 状態で開始 | 400 or 409 |
| 3 | 異常 | 管理者認証なし | 401 |

#### 次の問題 (`POST /api/admin/events/{event_id}/questions/next`)

| # | 種別 | テスト内容 | 期待結果 |
|---|------|-----------|----------|
| 1 | 正常 | 次の問題を表示 | 200, question_id・started_at・deadline_at 返却 |
| 2 | 正常 | 全問題出題済み | 200, state="finished" |
| 3 | 異常 | 管理者認証なし | 401 |
| 4 | 異常 | イベントが running でない | 400 |

#### 問題締切 (`POST /api/admin/events/{event_id}/questions/{question_id}/close`)

| # | 種別 | テスト内容 | 期待結果 |
|---|------|-----------|----------|
| 1 | 正常 | 出題中の問題を締切 | 200, closed_at 返却 |
| 2 | 異常 | 管理者認証なし | 401 |
| 3 | 異常 | アクティブでない question_id | 400 |

#### 正解表示 (`POST /api/admin/events/{event_id}/questions/{question_id}/reveal`)

| # | 種別 | テスト内容 | 期待結果 |
|---|------|-----------|----------|
| 1 | 正常 | 正解を公開 | 200, correct_choice_index 返却 |
| 2 | 異常 | close 前に reveal | 400 |
| 3 | 異常 | 管理者認証なし | 401 |

#### イベント終了 (`POST /api/admin/events/{event_id}/finish`)

| # | 種別 | テスト内容 | 期待結果 |
|---|------|-----------|----------|
| 1 | 正常 | イベント終了 | 200, state="finished" |
| 2 | 異常 | waiting 状態で finish | 400 |
| 3 | 異常 | 管理者認証なし | 401 |

#### イベントリセット (`POST /api/admin/events/{event_id}/reset`)

| # | 種別 | テスト内容 | 期待結果 |
|---|------|-----------|----------|
| 1 | 正常 | リセット成功 | 200, state="waiting", 参加者・回答データ削除 |
| 2 | 異常 | 管理者認証なし | 401 |

#### イベント中止 (`POST /api/admin/events/{event_id}/abort`)

| # | 種別 | テスト内容 | 期待結果 |
|---|------|-----------|----------|
| 1 | 正常 | 中止成功 | 200, state="aborted" |
| 2 | 異常 | 管理者認証なし | 401 |

#### 問題一覧 (`GET /api/admin/questions`)

| # | 種別 | テスト内容 | 期待結果 |
|---|------|-----------|----------|
| 1 | 正常 | 全問題取得 | 200, 問題リスト返却 |
| 2 | 正常 | enabled_only=true で絞り込み | 200, is_enabled=true のみ |
| 3 | 異常 | 管理者認証なし | 401 |

#### 問題作成 (`POST /api/admin/questions`)

| # | 種別 | テスト内容 | 期待結果 |
|---|------|-----------|----------|
| 1 | 正常 | 必須項目を指定して作成 | 200, 問題オブジェクト返却 |
| 2 | 異常 | question_text 未指定 | 400 or 422 |
| 3 | 異常 | choices が4つ未満 | 400 or 422 |
| 4 | 異常 | correct_choice_index が範囲外 | 400 or 422 |
| 5 | 異常 | 管理者認証なし | 401 |

#### 問題更新 (`PUT /api/admin/questions/{question_id}`)

| # | 種別 | テスト内容 | 期待結果 |
|---|------|-----------|----------|
| 1 | 正常 | question_text を更新 | 200, 更新後の問題返却 |
| 2 | 正常 | 一部フィールドのみ更新（partial update） | 200, 指定フィールドのみ更新 |
| 3 | 異常 | 存在しない question_id | 404 |
| 4 | 異常 | 管理者認証なし | 401 |

#### 問題有効/無効化 (`PUT /api/admin/questions/{question_id}/enabled`)

| # | 種別 | テスト内容 | 期待結果 |
|---|------|-----------|----------|
| 1 | 正常 | 問題を無効化 | 200, is_enabled=false |
| 2 | 正常 | 問題を有効化 | 200, is_enabled=true |
| 3 | 異常 | 存在しない question_id | 404 |
| 4 | 異常 | 管理者認証なし | 401 |

#### 問題並び替え (`PUT /api/admin/questions/reorder`)

| # | 種別 | テスト内容 | 期待結果 |
|---|------|-----------|----------|
| 1 | 正常 | ordered_ids で並び替え | 200 |
| 2 | 異常 | 存在しない question_id を含む | 400 or 404 |
| 3 | 異常 | 管理者認証なし | 401 |

#### 画像アップロード (`POST /api/admin/assets/images`)

| # | 種別 | テスト内容 | 期待結果 |
|---|------|-----------|----------|
| 1 | 正常 | PNG 画像をアップロード | 200, url・filename 返却 |
| 2 | 正常 | JPEG 画像をアップロード | 200 |
| 3 | 異常 | 許可されていないファイル形式（例: .txt） | 400 |
| 4 | 異常 | ファイル未指定 | 400 or 422 |
| 5 | 異常 | 管理者認証なし | 401 |

#### 監査ログ (`GET /api/admin/logs`)

| # | 種別 | テスト内容 | 期待結果 |
|---|------|-----------|----------|
| 1 | 正常 | ログ取得（デフォルト100件） | 200, ログリスト返却 |
| 2 | 正常 | limit パラメータ指定 | 200, 指定件数以内 |
| 3 | 異常 | 管理者認証なし | 401 |

---

### 1.4 WebSocket (`WS /api/ws?event_id={event_id}`)

| # | 種別 | テスト内容 | 期待結果 |
|---|------|-----------|----------|
| 1 | 正常 | 接続確立 | WS 接続成功 |
| 2 | 正常 | event.state_changed 受信 | イベント開始時に state="running" ブロードキャスト |
| 3 | 正常 | question.shown 受信 | 問題出題時に問題情報ブロードキャスト |
| 4 | 正常 | question.closed 受信 | 問題締切時に closed_at ブロードキャスト |
| 5 | 正常 | question.revealed 受信 | 正解表示時に correct_choice_index ブロードキャスト |
| 6 | 正常 | event.finished 受信 | イベント終了通知 |
| 7 | 正常 | echo テスト | テキスト送信 → `echo: {text}` 返却 |
| 8 | 異常 | 存在しない event_id で接続 | 接続拒否 or エラーメッセージ |
| 9 | 異常 | 接続切断後の自動再接続 | 1.5秒後に再接続 |
| 10 | 異常 | WS 切断時のポーリングフォールバック | 3秒間隔で REST API ポーリングに切替 |

---

## 2. UIテスト

### 2.1 参加者画面 — 参加フロー (JoinPage: `/`)

| # | 種別 | テスト内容 | 期待結果 |
|---|------|-----------|----------|
| 1 | 正常 | 参加コード入力 → 参加ボタン押下 | ユーザー名入力画面に遷移 |
| 2 | 正常 | 表示名入力 → 登録ボタン押下 | クイズ画面 (`/quiz/{eventId}`) に遷移 |
| 3 | 正常 | 既存セッションがある場合の自動復帰 | ページ読込時に自動でクイズ画面に遷移 |
| 4 | 異常 | 誤った参加コードを入力 | エラーメッセージ表示 |
| 5 | 異常 | 参加コード未入力で送信 | バリデーションエラー表示 |
| 6 | 異常 | 表示名未入力で送信 | バリデーションエラー表示 |
| 7 | 正常 | イベント終了後に参加ページにアクセス | 「終了済み」メッセージ表示、3秒ポーリングで次のイベント待機 |

---

### 2.2 参加者画面 — クイズ画面 (QuizPage: `/quiz/{eventId}`)

| # | 種別 | テスト内容 | 期待結果 |
|---|------|-----------|----------|
| 1 | 正常 | 問題表示（テキスト・画像・選択肢） | 問題文・選択肢が正しく表示 |
| 2 | 正常 | カウントダウンタイマー表示 | deadline までの残り時間が表示・更新される |
| 3 | 正常 | 選択肢をタップして回答送信 | 選択肢がハイライト、送信完了 |
| 4 | 正常 | 回答後に選択肢のロック | 回答済みの場合、再選択不可 |
| 5 | 正常 | 正解表示（reveal 後） | 正解の選択肢がハイライト、正誤がわかる |
| 6 | 正常 | イベント終了時に結果画面に自動遷移 | `/results/{eventId}` に遷移 |
| 7 | 正常 | waiting 状態で待機画面表示 | 「まもなく開始」等のメッセージ |
| 8 | 異常 | WS 切断時の動作 | ポーリングに自動切替、UX 劣化なし |
| 9 | 異常 | セッションなしでアクセス | 参加ページにリダイレクト |
| 10 | 異常 | イベント中止（aborted）時 | 中止メッセージ表示 |

---

### 2.3 参加者画面 — 結果画面 (ResultsPage: `/results/{eventId}`)

| # | 種別 | テスト内容 | 期待結果 |
|---|------|-----------|----------|
| 1 | 正常 | リーダーボード表示 | 順位・表示名・正解数・正答率・回答時間が表示 |
| 2 | 正常 | 自分のランクがハイライト | ログインユーザーの行が区別できる |
| 3 | 正常 | CSV エクスポートボタン | CSV ファイルがダウンロードされる |
| 4 | 異常 | 未終了イベントの結果画面にアクセス | 適切なメッセージ or リダイレクト |

---

### 2.4 管理者画面 — ログイン (AdminLoginPage: `/admin`)

| # | 種別 | テスト内容 | 期待結果 |
|---|------|-----------|----------|
| 1 | 正常 | 正しいパスワードでログイン | 管理ダッシュボードに遷移 |
| 2 | 異常 | 誤ったパスワードでログイン | エラーメッセージ表示 |
| 3 | 異常 | パスワード未入力で送信 | バリデーションエラー表示 |
| 4 | 異常 | 5回連続失敗後の試行 | レート制限エラー表示 |
| 5 | 正常 | 有効セッションでアクセス時の自動遷移 | ダッシュボードに自動遷移 |

---

### 2.5 管理者画面 — ダッシュボード (AdminDashboard)

| # | 種別 | テスト内容 | 期待結果 |
|---|------|-----------|----------|
| 1 | 正常 | イベント作成（タイトル・問題選択） | イベントが作成され waiting 状態 |
| 2 | 正常 | 参加コード表示・更新 | 現在の join_code が表示、変更可能 |
| 3 | 正常 | 「開始」ボタン押下 | state="running" に遷移 |
| 4 | 正常 | 「次の問題」ボタン押下 | 出題、参加者に問題配信 |
| 5 | 正常 | 「締切」ボタン押下 | 回答受付終了 |
| 6 | 正常 | 「正解表示」ボタン押下 | 参加者に正解が配信される |
| 7 | 正常 | 全問題完了後に「終了」 | state="finished" |
| 8 | 正常 | 自動モードでの進行 | next → close → reveal が自動で順次実行 |
| 9 | 正常 | 自動モードのカウントダウン表示 | 次アクションまでの秒数が表示 |
| 10 | 正常 | 「リセット」ボタン押下 | 参加者・回答クリア、state="waiting" |
| 11 | 正常 | 「中止」ボタン押下 | state="aborted" |
| 12 | 異常 | 状態に応じたボタンの無効化 | 不適切な操作ボタンが disabled |
| 13 | 異常 | 管理者セッション切れ時の動作 | ログイン画面にリダイレクト |

---

### 2.6 管理者画面 — 問題管理 (AdminQuestionsPage: `/admin/questions`)

| # | 種別 | テスト内容 | 期待結果 |
|---|------|-----------|----------|
| 1 | 正常 | 問題一覧表示 | 登録済み問題が一覧表示 |
| 2 | 正常 | 新規問題作成（テキスト・選択肢・正解指定） | 問題が追加される |
| 3 | 正常 | 問題編集 | 変更内容が保存される |
| 4 | 正常 | 問題の有効/無効切替 | is_enabled トグルが動作 |
| 5 | 正常 | ドラッグ＆ドロップで並び替え | sort_order が更新される |
| 6 | 正常 | 画像アップロード（問題・選択肢） | 画像がアップロードされプレビュー表示 |
| 7 | 異常 | 必須項目未入力で保存 | バリデーションエラー表示 |
| 8 | 異常 | 対応外ファイル形式のアップロード | エラーメッセージ表示 |
| 9 | 異常 | 管理者セッション切れ時の動作 | ログイン画面にリダイレクト |

---

## 3. AWS 固有の確認事項

| # | カテゴリ | テスト内容 | 期待結果 |
|---|---------|-----------|----------|
| 1 | RDS | PostgreSQL 接続確認 | ヘルスチェック正常、CRUD 動作 |
| 2 | RDS | コネクションプール上限到達時の動作 | 適切なエラーレスポンス、アプリクラッシュなし |
| 3 | ElastiCache | Valkey セッション保存・取得 | admin_session の保存・検証が動作 |
| 4 | ElastiCache | Valkey 接続不可時のフォールバック | インメモリセッションにフォールバック |
| 5 | S3 | 画像アップロード → S3 保存 | URL が S3/CloudFront パスで返却 |
| 6 | S3 | アップロード済み画像の参照 | CloudFront 経由で画像が表示される |
| 7 | CloudFront | 静的ファイル配信 | フロントエンド資材が CDN 経由で配信 |
| 8 | CORS | 本番ドメインからの API アクセス | CORS ヘッダーが正しく設定 |
| 9 | HTTPS | 全エンドポイントの SSL/TLS 確認 | 証明書有効、HTTP → HTTPS リダイレクト |
| 10 | Cookie | Secure・SameSite 属性の確認 | 本番環境で Cookie が正しく送受信される |
| 11 | WebSocket | WSS 接続確認 | TLS 経由の WebSocket 接続が確立 |
| 12 | 環境変数 | 本番環境変数の設定確認 | DATABASE_URL, REDIS_URL, S3_BUCKET_NAME 等が正しい |
| 13 | 負荷 | 同時接続 50+ ユーザーでの動作 | レスポンス遅延なし、WS ブロードキャスト正常 |
| 14 | ログ | CloudWatch へのログ出力確認 | アプリログが CloudWatch に出力される |

---

## 4. UIマニュアルテスト

> テスターがブラウザで手動実行するシナリオ一覧。
> 前提: バックエンドが起動済み、管理者パスワードが既知であること。

---

### 4.1 シナリオ: 参加者の基本フロー（参加 → 回答 → 結果確認）

**前提条件**: 管理者がイベントを作成済み、join_code が共有されている

| 手順 | 操作 | 確認ポイント |
|------|------|-------------|
| 1 | ブラウザで `/` にアクセス | 参加コード入力フォームが表示される |
| 2 | 参加コードを入力し「参加」ボタンを押す | エラーなく次の画面に遷移する |
| 3 | 表示名を入力し「登録」ボタンを押す | `/quiz/{eventId}` に遷移し、待機画面が表示される |
| 4 | 管理者がイベントを開始するまで待つ | 「まもなく開始」等の待機メッセージが表示される |
| 5 | 管理者が「次の問題」を押す | 問題文・選択肢・タイマーが表示される |
| 6 | 制限時間内に選択肢をタップ | 選択した選択肢がハイライトされる |
| 7 | 管理者が「締切」→「正解表示」を押す | 正解がハイライト表示、自分の正誤がわかる |
| 8 | 全問題終了後 | 自動で `/results/{eventId}` に遷移する |
| 9 | 結果画面を確認 | 自分の順位・正解数・正答率・回答時間が表示される |

---

### 4.2 シナリオ: 参加者の異常系フロー

| 手順 | 操作 | 確認ポイント |
|------|------|-------------|
| 1 | `/` で誤った参加コードを入力して送信 | エラーメッセージが表示され、再入力可能 |
| 2 | 参加コード入力欄を空のまま送信 | バリデーションエラーが表示される |
| 3 | 表示名入力欄を空のまま送信 | バリデーションエラーが表示される |
| 4 | クイズ画面で回答せずタイマーが 0 になる | 選択肢がロックされ、未回答扱いになる |
| 5 | クイズ中にブラウザをリロード | セッションが復元され、現在の問題が再表示される |
| 6 | クイズ中にネットワークを一時切断 → 復旧 | WS 再接続後、最新の問題状態が反映される |
| 7 | 回答送信後に同じ問題で再度選択肢をタップ | 選択肢がロック済みで操作不可 |
| 8 | イベント中止（abort）時 | 中止メッセージが表示される |
| 9 | セッションなしで `/quiz/{eventId}` に直接アクセス | `/` にリダイレクトされる |
| 10 | 終了済みイベントの `/` にアクセス | 「終了済み」メッセージ表示、新イベント待機 |

---

### 4.3 シナリオ: 管理者ログイン

| 手順 | 操作 | 確認ポイント |
|------|------|-------------|
| 1 | `/admin` にアクセス | パスワード入力フォームが表示される |
| 2 | 正しいパスワードを入力してログイン | ダッシュボード画面に遷移する |
| 3 | ブラウザをリロード | セッションが維持され、ダッシュボードが表示される |
| 4 | 誤ったパスワードを入力してログイン | エラーメッセージが表示される |
| 5 | 誤ったパスワードを5回連続入力 | レート制限エラーが表示される |
| 6 | レート制限中に正しいパスワードを入力 | レート制限エラーが表示される（15分待機が必要） |

---

### 4.4 シナリオ: 管理者によるイベント進行（手動モード）

**前提条件**: 管理者ログイン済み、問題が登録済み

| 手順 | 操作 | 確認ポイント |
|------|------|-------------|
| 1 | ダッシュボードでイベントを作成 | タイトル・参加コードが表示される |
| 2 | 参加コードを確認する | join_code が表示されている |
| 3 | 参加コードを変更する | 新しい join_code が反映される |
| 4 | 別ブラウザで参加者として参加する | 参加者が正常に参加できる |
| 5 | 「開始」ボタンを押す | state が running に変更、参加者画面に反映 |
| 6 | 「次の問題」ボタンを押す | 管理者画面に問題情報表示、参加者に問題配信 |
| 7 | 参加者が回答する | 管理者画面に影響なし（参加者のみ操作） |
| 8 | 「締切」ボタンを押す | 回答受付終了、参加者は回答不可に |
| 9 | 「正解表示」ボタンを押す | 参加者画面に正解がハイライト表示 |
| 10 | 手順 6〜9 を全問題分繰り返す | 各問題が順次進行する |
| 11 | 最後の問題の正解表示後、「終了」ボタンを押す | state が finished に変更 |
| 12 | 参加者画面を確認 | 自動で結果画面に遷移している |

---

### 4.5 シナリオ: 管理者によるイベント進行（自動モード）

**前提条件**: 管理者ログイン済み、イベント作成済み、参加者が参加済み

| 手順 | 操作 | 確認ポイント |
|------|------|-------------|
| 1 | 「開始」ボタンを押す | state が running に変更 |
| 2 | 自動モードを有効にする | 自動進行が開始される |
| 3 | 自動モード中のカウントダウンを確認 | 次アクションまでの残り秒数が表示 |
| 4 | 自動で「次の問題」が実行される | 参加者画面に問題が表示される |
| 5 | 自動で「締切」が実行される | 回答受付が終了する |
| 6 | 自動で「正解表示」が実行される | 参加者画面に正解が表示される |
| 7 | 全問題が自動進行で完了する | state が finished になり、結果画面に遷移 |

---

### 4.6 シナリオ: 管理者によるイベントリセット・中止

| 手順 | 操作 | 確認ポイント |
|------|------|-------------|
| 1 | イベント進行中に「中止」ボタンを押す | state が aborted に変更 |
| 2 | 参加者画面を確認 | 中止メッセージが表示される |
| 3 | 「リセット」ボタンを押す | state が waiting に戻る |
| 4 | 参加者のデータを確認 | 参加者・回答データがクリアされている |
| 5 | 再度参加者が参加 → イベント開始 | 正常に最初から進行できる |

---

### 4.7 シナリオ: 問題管理（CRUD）

**前提条件**: 管理者ログイン済み

| 手順 | 操作 | 確認ポイント |
|------|------|-------------|
| 1 | `/admin/questions` にアクセス | 問題一覧が表示される |
| 2 | 「新規作成」で問題文・選択肢4つ・正解を入力して保存 | 問題が一覧に追加される |
| 3 | 作成した問題の「編集」を押す | 編集フォームに既存値がプリセットされる |
| 4 | 問題文を変更して保存 | 変更が反映される |
| 5 | 問題の有効/無効トグルを切替 | is_enabled の状態が切り替わる |
| 6 | 問題をドラッグ＆ドロップで並び替え | 並び順が変更され保存される |
| 7 | 問題に画像をアップロード | 画像がプレビュー表示される |
| 8 | 選択肢に画像をアップロード | 選択肢の画像がプレビュー表示される |
| 9 | 必須項目を空にして保存を試みる | バリデーションエラーが表示される |
| 10 | 非対応ファイル（.txt 等）をアップロード | エラーメッセージが表示される |

---

### 4.8 シナリオ: 複数参加者での同時プレイ

**前提条件**: イベント作成済み、2台以上のブラウザ/デバイスを使用

| 手順 | 操作 | 確認ポイント |
|------|------|-------------|
| 1 | 参加者 A・B がそれぞれ別ブラウザで参加 | 2人とも正常に参加・登録できる |
| 2 | 管理者がイベントを開始 | 両方の参加者画面に反映される |
| 3 | 管理者が問題を出題 | A・B 両方に同時に問題が表示される |
| 4 | A が正答、B が誤答を選択 | それぞれ正しく回答が送信される |
| 5 | 管理者が正解表示 | A・B 両方に正解が表示される |
| 6 | 全問題終了後の結果画面 | A が上位、B が下位にランキングされる |
| 7 | A の画面で自分の行がハイライトされている | A のランクが識別できる |
| 8 | B の画面で自分の行がハイライトされている | B のランクが識別できる |

---

### 4.9 シナリオ: CSV エクスポート

**前提条件**: イベントが終了済み

| 手順 | 操作 | 確認ポイント |
|------|------|-------------|
| 1 | 結果画面で CSV エクスポートボタンを押す | CSV ファイルがダウンロードされる |
| 2 | ダウンロードした CSV を Excel で開く | 文字化けなし（BOM 付き UTF-8） |
| 3 | CSV のカラムを確認 | 順位・表示名・正解数・未回答数・正答率・回答時間合計(秒) がある |
| 4 | CSV のデータと結果画面を照合 | 順位・数値が一致している |

---

### 4.10 シナリオ: ブラウザ互換性

| # | 対象ブラウザ | 確認ポイント |
|---|-------------|-------------|
| 1 | Chrome（最新） | 全画面・全機能が正常動作する |
| 2 | Safari（最新） | 全画面・全機能が正常動作する |
| 3 | Firefox（最新） | 全画面・全機能が正常動作する |
| 4 | Edge（最新） | 全画面・全機能が正常動作する |
| 5 | iOS Safari | タップ操作・WS 接続が正常に動作する |
| 6 | Android Chrome | タップ操作・WS 接続が正常に動作する |

---

### 4.11 シナリオ: レスポンシブ表示

| # | デバイス / 画面幅 | 確認ポイント |
|---|------------------|-------------|
| 1 | スマートフォン（375px） | 参加画面・クイズ画面・結果画面が崩れず表示 |
| 2 | スマートフォン（375px） | 選択肢ボタンがタップしやすいサイズ |
| 3 | タブレット（768px） | 全画面が適切にレイアウトされる |
| 4 | PC（1280px以上） | 管理画面を含め全画面が正常表示 |
| 5 | 画面回転（縦↔横） | レイアウト崩れなし |

---

### 4.12 シナリオ: セッション・Cookie 関連

| 手順 | 操作 | 確認ポイント |
|------|------|-------------|
| 1 | 参加者としてクイズに参加後、ブラウザを閉じて再度開く | セッションが維持され、クイズ画面に復帰できる |
| 2 | 参加者がログアウト後、`/quiz/{eventId}` にアクセス | `/` にリダイレクトされる |
| 3 | 管理者としてログイン後、ブラウザを閉じて再度開く | セッションが維持され、ダッシュボードが表示される |
| 4 | Cookie を手動削除後にページをリロード | 未認証状態に戻り、ログイン/参加画面が表示される |
| 5 | シークレットウィンドウで `/admin` にアクセス | ログイン画面が表示される（既存セッションの影響なし） |

---

### 4.13 シナリオ: エッジケース

| # | 操作 | 確認ポイント |
|---|------|-------------|
| 1 | 問題画像が設定されていない問題の表示 | 画像エリアが非表示、レイアウト崩れなし |
| 2 | 長い問題文（100文字超）の表示 | テキストが折り返し表示され、はみ出さない |
| 3 | 長い選択肢テキストの表示 | 選択肢ボタン内でテキストが適切に折り返す |
| 4 | 長い表示名のユーザーの結果画面表示 | テーブルが崩れない |
| 5 | 参加者 0 人でイベントを開始 → 終了 | エラーなく終了、結果画面は空のリーダーボード |
| 6 | 全員未回答で終了 | 全員の正解数 0・未回答数 = 問題数で表示 |
| 7 | 回答時間ギリギリ（残り1秒以内）に回答送信 | accepted or rejected が正しく判定される |
| 8 | 管理者画面とクイズ画面を同一ブラウザの別タブで開く | Cookie 競合なく両方動作する |
